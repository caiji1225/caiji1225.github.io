<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>空空</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="一、mysql 有两种存储引擎    1、mysql 数据库    存储引擎是myisam, 在data目录下会看到3类文件：.frm、.myi、.myd        (1).frm–表定义，是描述表结构的文件。        (2).MYD–”D”数据信息文件，是表的数据文件。        (3)*.MYI–”I”索引信息文件，是表数据文件中任何索引的数据树 2、存储引擎是InnoDB, 在">
<meta property="og:type" content="article">
<meta property="og:title" content="空空">
<meta property="og:url" content="http://example.com/2023/01/09/mysql/index.html">
<meta property="og:site_name" content="空空">
<meta property="og:description" content="一、mysql 有两种存储引擎    1、mysql 数据库    存储引擎是myisam, 在data目录下会看到3类文件：.frm、.myi、.myd        (1).frm–表定义，是描述表结构的文件。        (2).MYD–”D”数据信息文件，是表的数据文件。        (3)*.MYI–”I”索引信息文件，是表数据文件中任何索引的数据树 2、存储引擎是InnoDB, 在">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-01-09T15:12:28.898Z">
<meta property="article:modified_time" content="2022-09-08T10:05:34.093Z">
<meta property="article:author" content="两袖空空">
<meta property="article:tag" content="笔记 , 研究 , 漏洞">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="空空" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">空空</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">两袖空空的随手记</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-mysql" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/09/mysql/" class="article-date">
  <time class="dt-published" datetime="2023-01-09T15:12:28.898Z" itemprop="datePublished">2023-01-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>一、mysql 有两种存储引擎<br>    1、mysql 数据库<br>    存储引擎是myisam, 在data目录下会看到3类文件：.frm、.myi、.myd<br>        (1).frm–表定义，是描述表结构的文件。<br>        (2).MYD–”D”数据信息文件，是表的数据文件。<br>        (3)*.MYI–”I”索引信息文件，是表数据文件中任何索引的数据树</p>
<pre><code>2、存储引擎是InnoDB, 在data目录下会看到2类文件：.frm、.ibd
(1).frm–表结构的文件
        MYSQL中建立任何一张数据表，在其数据目录对应的数据库目录下都有对应表的.frm文件
        .frm文件是用来保存每个数据表的元数据(meta)信息，包括表结构的定义等
        .frm文件跟数据库存储引擎无关，也就是任何存储引擎的数据表都必须有.frm文件
        命名方式为数据表名.frm，如user.frm. .frm文件可以用来在数据库崩溃时恢复表结构。
(2).ibd–表数据和索引的文件。该表的索引(B+树)的每个非叶子节点存储索引，叶子节点存储索引和索引对应的数据。

    
</code></pre>
<p>二、恢复方法<br>首先恢复表结构<br>    1、基于MyISAM 表结构恢复<br>        假定需要恢复的表的FRM文件为test_myisam.frm,表结构为<br>        mysql&gt; create table test_myisam<br>            -&gt; (A int(11) default NULL,<br>            -&gt; B varchar(30) default NULL,<br>            -&gt; C date default NULL) engine&#x3D;myisam;<br>        Query OK, 0 rows affected (0.05 sec)<br>        步骤一：<br>            直接将test_myisam.frm 文件考到正常数据库对应目录下测试<br>            mysql&gt; show tables;<br>            +————–+<br>            | Tables_in_aa |<br>            +————–+<br>            | test_innodb |<br>            | test_myisam |<br>            +————–+<br>            3 rows in set (0.00 sec)<br>            mysql&gt; desc test_myisam;<br>            ERROR 1017 (HY000): Can’t find file: ‘test_myisam’ (errno: 2)<br>            注：发现只能通过show tables 命令看见表名，desc报错，说明表结构没有恢复<br>        步骤二：<br>            新建test_myisam.MYD 和test_myisamMYI文件 内容可以为空<br>            在MYSQL命令行使用MYSQL本身的数据表恢复命令repair命令恢复表，如下：<br>            mysql&gt; repair table test_myisam USE_FRM;<br>            +—————–+——–+———-+———-+<br>            | Table          | Op    | Msg_type | Msg_text |<br>            +—————–+——–+———-+———-+<br>            | aa.test_myisam | repair | status   | OK      |<br>            +—————–+——–+———-+———-+<br>            1 row in set (0.00 sec)<br>            根据结果可以知道,恢复命令执行成功，下边用desc命令测试下（用show create table命令测试）：<br>            mysql&gt; desc test_myisam;<br>            +——-+————-+——+—–+———+——-+<br>            | Field | Type        | Null | Key | Default | Extra |<br>            +——-+————-+——+—–+———+——-+<br>            | A    | int(11)    | YES  |    | NULL    |      |<br>            | B    | varchar(30) | YES  |    | NULL    |      |<br>            | C    | date        | YES  |    | NULL    |      |<br>            +——-+————-+——+—–+———+——-+<br>            3 rows in set (0.02 sec)<br>            恢复成功</p>
<pre><code>2、基于InnoDB表结构的恢复
    假定该文件为test_innodb.frm.
    该表创建脚本如下：
        mysql&gt; create table test_innodb
        -&gt; (A int(11) default NULL,
        -&gt; B varchar(30) default NULL,
        -&gt; C date default NULL) engine=innodb;
        Query OK, 0 rows affected (0.05 sec)
    步骤一：
        在新MYSQL环境下建立数据库 如 aa
    步骤二：
        在aa数据库下建立同名数据库表。结构随意，目前只有一个id字段。但是表名和之前对应
        如：mysql&gt; create table test_innodb (id bigint not null)engine=InnoDB;
        Query OK, 0 rows affected (0.09 sec)
        mysql&gt; show tables;
        +--------------+
        | Tables_in_aa |
        +--------------+
        | test_innodb |
        +--------------+
        2 rows in set (0.00 sec)

        mysql&gt; desc test_innodb;
        +-------+------------+------+-----+---------+-------+
        | Field | Type      | Null | Key | Default | Extra |
        +-------+------------+------+-----+---------+-------+
        | id    | bigint(20) | NO  |    | NULL    |      |
        +-------+------------+------+-----+---------+-------+
        1 row in set (0.00 sec)
    步骤三：
        停止mysql服务，将损毁后备份的.frm文件copy 到aa目录下，覆盖同名的frm文件
        重启mysql服务
        mysql&gt; desc test_innodb;
        +-------+-------------+------+-----+---------+-------+
        | Field | Type        | Null | Key | Default | Extra |
        +-------+-------------+------+-----+---------+-------+
        | A    | int(11)    | YES  |    | NULL    |      |
        | B    | varchar(30) | YES  |    | NULL    |      |
        | C    | date        | YES  |    | NULL    |      |
        +-------+-------------+------+-----+---------+-------+
        3 rows in set (0.01 sec)
    成功恢复
</code></pre>
<p>参考链接：<a target="_blank" rel="noopener" href="https://blog.sina.com.cn/s/blog_5d3da3280100hymn.html%EF%BC%88%E6%81%A2%E5%A4%8D%E8%A1%A8%E7%BB%93%E6%9E%84%EF%BC%89">https://blog.sina.com.cn/s/blog_5d3da3280100hymn.html（恢复表结构）</a></p>
<p>三、恢复表数据<br>    1、将新建的表DISCARD掉<br>    命令行执行：<br>        ALTER TABLE table1 DISCARD TABLESPACE;<br>    2、将备份的源表数据文件.ibd拷贝过来<br>    将.ibd文件放到新数据库的data目录下，覆盖刚创建表时新生成的.ibd文件</p>
<pre><code>即/usr/local/mysql/data/db1/下
3、将拷贝过来的.ibd表数据导入进来
    ALTER TABLE  `table1` IMPORT TABLESPACE;
 
</code></pre>
<p>参考链接：<a target="_blank" rel="noopener" href="https://www.chriscalender.com/recovering-an-innodb-table-from-only-an-ibd-file/">https://www.chriscalender.com/recovering-an-innodb-table-from-only-an-ibd-file/</a><br>参考链接：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/meitian/p/9886654.html">https://www.cnblogs.com/meitian/p/9886654.html</a> （恢复数据）<br>此方法恢复数据的前提：建表用的innodb索引</p>
<p>备注：如果mysql的目录还都在，可以先尝试，将mysql下的目录都拷贝到一个新mysql目录下，启动看看能不能用，不能用后再尝试下面方法</p>
<p>mysql会有一个data目录存储表结构和表数据。下面的目录结构大概如下：<br>ib_logfile0<br>ib_logfile1<br>ibdata1<br>ibtmp1<br>xx数据库1<br>xx数据库2</p>
<p>每个数据库目录下面的表内容如下：<br>表1.frm<br>表1.ibd<br>表2.frm<br>表2.ibd<br>.frm文件：表结构文件<br>.ibd文件：表数据文件</p>
<p>下面为恢复数据方法<br>备注：这里假设要备注的库名为db1，表名为table1<br>1、先备份要恢复数据的表文件<br>table1.frm和table1.ibd文件</p>
<p>可以直接把原数据库的data目录整个拷贝过来，如果指定了data目录可以通过查看mysql的进程看到具体配置位置<br>2、新搭建一个mysql<br>我用的5.7，搭建在mac本地<br>3、将mysql下的log文件删除，不要保留和要备份的库相同的内容<br>如果你是完全新建的一个数据库，和原来的库表完全无关，可以忽略这步骤</p>
<p>rm -rf &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;ib_logfile0<br>rm -rf &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;ib_logfile1<br>rm -rf &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;ibdata1<br>rm -rf &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;btmp1<br>rm -rf &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;db1<br>4、新建数据库<br>链接上mysql命令行<br>create database db1;</p>
<p>5、通过命令行新建原来的表，<br>注意，一定在建表命令后加【ROW_FORMAT&#x3D;COMPACT】防止冲突</p>
<p>例如：</p>
<p>DROP TABLE IF EXISTS <code>table1</code>;<br>CREATE TABLE <code>table1</code> (<br>  <code>name</code> varchar(200) NOT NULL DEFAULT ‘’ COMMENT ‘key值’,<br>  <code>value</code> varchar(500) DEFAULT NULL COMMENT ‘value值’,<br>  <code>desc</code> varchar(500) DEFAULT NULL COMMENT ‘关于当前key的描述信息’,<br>  PRIMARY KEY (<code>name</code>)<br>) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 ROW_FORMAT&#x3D;COMPACT;</p>
<p>如果不记得表结构了，可以先参考下面的文章找回表结构，dump出sql结构后获得创建表的语句：<br><a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_5d3da3280100hymn.html">http://blog.sina.com.cn/s/blog_5d3da3280100hymn.html</a><br>6、将新建的表DISCARD掉<br>命令行执行：<br>ALTER TABLE table1 DISCARD TABLESPACE;<br>7、将备份的源表数据文件.ibd拷贝过来<br>将.ibd文件放到新数据库的data目录下，覆盖刚创建表时新生成的.ibd文件</p>
<p>即&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;db1&#x2F;下<br>8、将拷贝过来的.ibd表数据导入进来<br>ALTER TABLE  <code>table1</code> IMPORT TABLESPACE;</p>
<p>数据成功恢复</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/09/mysql/" data-id="clcoy0fcw000nd4vp55qi20gl" data-title="" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/01/09/nbtscan/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2023/01/09/msfvenom/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AV/">AV</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Domain/">Domain</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IPC/">IPC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Intranet/">Intranet</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Intranet/IPC/">IPC</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AV/" rel="tag">AV</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Domain/" rel="tag">Domain</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/AV/" style="font-size: 10px;">AV</a> <a href="/tags/Domain/" style="font-size: 10px;">Domain</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">一月 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/01/09/book/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/01/09/book/hexo/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/01/09/apt/sources/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/01/09/%E5%BC%BA%E8%A1%8C%E6%94%B9%E5%BC%80%E6%9C%BA%E5%AF%86%E7%A0%81/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/01/09/zzcms%E6%BC%8F%E6%B4%9E/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 两袖空空<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>