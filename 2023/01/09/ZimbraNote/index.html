<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>空空随笔</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="CVE-2015-1197  详情：    是一个目录遍历漏洞：提取包含符号链接的特制存档可能导致文件被放置在文件系统中的任意位置 CVE-2022-27925 Zimbra任意文件上传漏洞 简介：    Zimbra提供一套开源协同办公套件包括WebMail，日历，通信录，Web文档管理和创作。    特色在于其采用Ajax技术模仿CS桌面应用软件的风格开发的客户端兼容Firefox,Safar">
<meta property="og:type" content="article">
<meta property="og:title" content="空空随笔">
<meta property="og:url" content="http://example.com/2023/01/09/ZimbraNote/index.html">
<meta property="og:site_name" content="空空随笔">
<meta property="og:description" content="CVE-2015-1197  详情：    是一个目录遍历漏洞：提取包含符号链接的特制存档可能导致文件被放置在文件系统中的任意位置 CVE-2022-27925 Zimbra任意文件上传漏洞 简介：    Zimbra提供一套开源协同办公套件包括WebMail，日历，通信录，Web文档管理和创作。    特色在于其采用Ajax技术模仿CS桌面应用软件的风格开发的客户端兼容Firefox,Safar">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-01-09T15:12:29.181Z">
<meta property="article:modified_time" content="2022-11-24T07:27:49.938Z">
<meta property="article:author" content="两袖空空">
<meta property="article:tag" content="笔记 , 研究 , 漏洞">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="空空随笔" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">空空随笔</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">随手记</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-ZimbraNote" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/09/ZimbraNote/" class="article-date">
  <time class="dt-published" datetime="2023-01-09T15:12:29.181Z" itemprop="datePublished">2023-01-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>CVE-2015-1197 </p>
<p>详情：<br>    是一个目录遍历漏洞：提取包含符号链接的特制存档可能导致文件被放置在文件系统中的任意位置</p>
<p>CVE-2022-27925 Zimbra任意文件上传漏洞</p>
<p>简介：<br>    Zimbra提供一套开源协同办公套件包括WebMail，日历，通信录，Web文档管理和创作。<br>    特色在于其采用Ajax技术模仿CS桌面应用软件的风格开发的客户端兼容Firefox,Safari和IE浏览器。<br>详情：<br>    Zimbra Collaboration（又称ZCS）8.8.15和9.0具有mboximport功能，<br>    可接收ZIP存档并从中提取文件，具有管理员权限的认证用户可以将任意文件上传到系统中，<br>    从而导致目录遍历或远程代码执行。<br>    此漏洞已于2022 年3月在8.8.15P31和9.0.0P24中修复，目前已发现被利用。</p>
<p>影响版本：<br>    ZCS &lt; 8.8.15 patch 33<br>    ZCS &lt; 9.0.0 patch 26</p>
<p>修复方案：<br>        目前这些漏洞已经修复，受影响用户可升级到Zimbra 8.8.15P33、9.0.0P26或更高版本。</p>
<p>CVE-2022-41352漏洞</p>
<p>详情：</p>
<pre><code>1、Zimbra 在 Ubuntu 20.04 或 18.04 上运行，管理员无需执行任何操作，
    但 Oracle Linux 8、Red Hat Enterprise Linux 8、Rocky Linux 8 和 CentOS 8 容易受到攻击，应实施解决方法。
2、在 Zimbra Collaboration (ZCS) 8.8.15 和 9.0 中发现了一个问题。	
    攻击者可以通过 amavisd 通过 cpio 漏洞（提取到 /opt/zimbra/jetty/webapps/zimbra/public）上传任意文件，
    这可能导致对任何其他用户帐户的不正确访问。
</code></pre>
<p>攻击步骤：<br>    1、攻击者发送一封附有恶意 Tar 存档的电子邮件。<br>    2、收到电子邮件后，Zimbra 将其提交给 Amavis 进行垃圾邮件和恶意软件检查。<br>    3、Amavis 分析电子邮件附件并检查附件档案的内容。它调用 cpio 并触发 CVE-2015-1197。<br>    4、在提取期间，JSP webshel​​l 部署在 webmail 组件使用的公共目录之一上。<br>        攻击者可以浏览到 webshel​​l 以开始在受害机器上执行任意命令。</p>
<p>修复建议：	<br>    Zimbra 推荐 pax 而不是 cpio。<br>    此外，pax 是 Ubuntu 上 Zimbra 默认的先决条件；<br>    但是，在 RHEL 6（或 CentOS 6）之后，pax 不再是默认 Red Hat 安装的一部分。<br>    安装 pax 后，amavisd 会自动将其优先于 cpio，但是Zimbra 内外的其他程序路径仍可能导致 cpio 处理不受信任的数据。</p>
<p>当前系统：<br>    Distribution					Vulnerable to CVE-2022-41352<br>    Red Hat Enterprise Linux 7		Yes<br>    Red Hat Enterprise Linux 8		Yes<br>    CentOS 7						Yes<br>    CentOS 8						Yes<br>    Oracle Linux 7					Yes<br>    Oracle Linux 8					Yes<br>    Rocky Linux 8					Yes<br>    Ubuntu 16.04 LTS				No<br>    Ubuntu 18.04 LTS				No<br>    Ubuntu 20.04 LTS				No</p>
<p>★Zimbra 环境搭建</p>
<pre><code>1、禁用SELinux，然后停止SELinux运行：
    setenforce 0
    编辑SELinux配置文件，服务器重启之后仍然会保持禁用状态：
        vi /etc/selinux/config
    将上述文件中的
        SELINUX=enforced
    修改为
        SELINUX=disabled

2、修改host 和主机名（cat文件里只有这些内容 ，修改完后可能需要重启）
    vim  /etc/hosts
        ip  test.com
        
    vim /etc/hostname
        test.com

3、下载安装包：
    wget https://files.zimbra.com/downloads/8.8.9_GA/zcs-8.8.9_GA_3019.UBUNTU16_64.20180809160254.tgz
    wget https://files.zimbra.com/downloads/8.8.15_GA/zcs-8.8.15_GA_3869.UBUNTU18_64.20190918004220.tgz
    解压
    tar -zxvf *.tgz
    cd
    ./install.sh
</code></pre>
<p>——降级操作[ 根据需要操作该步骤]—–<br>        解压缩后需要删除包中utils&#x2F;globals.sh,删除其中的zimbra-patch行，否则安装时会安装更新。<br>        调用install.sh安装时，不能使用8.7.11的输入重定向。<br>        由于zimbra-chat是apt安装，会自动安装最新版，所以最后还得给zimbra-chat插件降个级:<br>        apt-get install zimbra-chat&#x3D;2.0.1.1532356008-1.u16<br>        su - zimbra<br>        zmmailboxdctl restart<br>    4、选择：<br>        Select the packages to install<br>        Install zimbra-ldap [Y]<br>        Install zimbra-logger [Y]<br>        Install zimbra-mta [Y]<br>        Install zimbra-dnscache [Y] n<br>        Install zimbra-snmp [Y]<br>        Install zimbra-store [Y]<br>        Install zimbra-apache [Y]<br>        Install zimbra-spell [Y]<br>        Install zimbra-convertd [Y]<br>        Install zimbra-memcached [Y]<br>        Install zimbra-proxy [Y]<br>        Install zimbra-archiving [N]<br>        Install zimbra-drive [Y]<br>        Install zimbra-imapd (BETA - for evaluation only) [N]<br>        Install zimbra-network-modules-ng [Y]<br>        Install zimbra-talk [Y] </p>
<pre><code>    The system will be modified.  Continue? [N] y
    
    Change domain name? [Yes] n
</code></pre>
<p>之后跳出		<br>        Main menu</p>
<pre><code>   1) Common Configuration:
   2) zimbra-ldap:                             Enabled
   3) zimbra-logger:                           Enabled
   4) zimbra-mta:                              Enabled
   5) zimbra-dnscache:                         Enabled
   6) zimbra-snmp:                             Enabled
   7) zimbra-store:                            Enabled
        +Create Admin User:                    yes
        +Admin user to create:                 admin@test.com
******* +Admin Password                        UNSET
        +Anti-virus quarantine user:           virus-quarantine.slazbuwc@test.com
        +Enable automated spam training:       yes
        +Spam training user:                   spam.nitfc4t4@test.com
        +Non-spam(Ham) training user:          ham.dtss42d5@test.com
        +SMTP host:                            test.com
        +Web server HTTP port:                 8080
        +Web server HTTPS port:                8443
        +Web server mode:                      https
        +IMAP server port:                     7143
        +IMAP server SSL port:                 7993
        +POP server port:                      7110
        +POP server SSL port:                  7995
        +Use spell check server:               yes
        +Spell server URL:                     http://test.com:7780/aspell.php
        +Enable version update checks:         TRUE
        +Enable version update notifications:  TRUE
        +Version update notification email:    admin@test.com
        +Version update source email:          admin@test.com
        +Install mailstore (service webapp):   yes
        +Install UI (zimbra,zimbraAdmin webapps): yes

   8) zimbra-spell:                            Enabled
   9) zimbra-proxy:                            Enabled
  10) zimbra-imapd:                            Enabled
  11) Default Class of Service Configuration:
   s) Save config to file
   x) Expand menu
   q) Quit
</code></pre>
<p>选择 7<br>    Address unconfigured (**) items  (? - help) 7<br>    Store configuration</p>
<pre><code>   1) Status:                                  Enabled
   2) Create Admin User:                       yes
   3) Admin user to create:                    admin@test.com
** 4) Admin Password                           UNSET
   5) Anti-virus quarantine user:              virus-quarantine.slazbuwc@test.com
   6) Enable automated spam training:          yes
   7) Spam training user:                      spam.nitfc4t4@test.com
   8) Non-spam(Ham) training user:             ham.dtss42d5@test.com
   9) SMTP host:                               test.com
  10) Web server HTTP port:                    8080
  11) Web server HTTPS port:                   8443
  12) Web server mode:                         https
  13) IMAP server port:                        7143
  14) IMAP server SSL port:                    7993
  15) POP server port:                         7110
  16) POP server SSL port:                     7995
  17) Use spell check server:                  yes
  18) Spell server URL:                        http://test.com:7780/aspell.php
  19) Enable version update checks:            TRUE
  20) Enable version update notifications:     TRUE
  21) Version update notification email:       admin@test.com
  22) Version update source email:             admin@test.com
  23) Install mailstore (service webapp):      yes
  24) Install UI (zimbra,zimbraAdmin webapps): yes
</code></pre>
<p>选择 4<br>    Select, or ‘r’ for previous menu [r] 4</p>
<p>设置密码<br>    Password for <a href="mailto:&#97;&#x64;&#109;&#x69;&#110;&#64;&#x74;&#101;&#115;&#x74;&#46;&#99;&#x6f;&#x6d;">&#97;&#x64;&#109;&#x69;&#110;&#64;&#x74;&#101;&#115;&#x74;&#46;&#99;&#x6f;&#x6d;</a> (min 6 characters): [wzYXRCHZ9]123456@QJADG&amp;du<br>    Store configuration</p>
<ol>
<li>Status:                                  Enabled</li>
<li>Create Admin User:                       yes</li>
<li>Admin user to create:                    <a href="mailto:&#97;&#100;&#109;&#x69;&#x6e;&#x40;&#116;&#x65;&#115;&#x74;&#x2e;&#x63;&#x6f;&#x6d;">&#97;&#100;&#109;&#x69;&#x6e;&#x40;&#116;&#x65;&#115;&#x74;&#x2e;&#x63;&#x6f;&#x6d;</a></li>
<li>Admin Password                           set</li>
<li>Anti-virus quarantine user:              <a href="mailto:&#x76;&#105;&#x72;&#117;&#x73;&#45;&#x71;&#117;&#x61;&#x72;&#97;&#x6e;&#116;&#105;&#x6e;&#x65;&#46;&#115;&#x6c;&#x61;&#x7a;&#x62;&#117;&#119;&#x63;&#64;&#116;&#101;&#115;&#116;&#x2e;&#x63;&#111;&#x6d;">&#x76;&#105;&#x72;&#117;&#x73;&#45;&#x71;&#117;&#x61;&#x72;&#97;&#x6e;&#116;&#105;&#x6e;&#x65;&#46;&#115;&#x6c;&#x61;&#x7a;&#x62;&#117;&#119;&#x63;&#64;&#116;&#101;&#115;&#116;&#x2e;&#x63;&#111;&#x6d;</a></li>
<li>Enable automated spam training:          yes</li>
<li>Spam training user:                      <a href="mailto:&#x73;&#112;&#97;&#109;&#x2e;&#110;&#x69;&#116;&#102;&#x63;&#52;&#x74;&#x34;&#64;&#x74;&#x65;&#x73;&#x74;&#x2e;&#99;&#111;&#x6d;">&#x73;&#112;&#97;&#109;&#x2e;&#110;&#x69;&#116;&#102;&#x63;&#52;&#x74;&#x34;&#64;&#x74;&#x65;&#x73;&#x74;&#x2e;&#99;&#111;&#x6d;</a></li>
<li>Non-spam(Ham) training user:             <a href="mailto:&#x68;&#97;&#x6d;&#x2e;&#x64;&#x74;&#115;&#115;&#x34;&#x32;&#100;&#x35;&#64;&#x74;&#101;&#x73;&#116;&#x2e;&#x63;&#x6f;&#109;">&#x68;&#97;&#x6d;&#x2e;&#x64;&#x74;&#115;&#115;&#x34;&#x32;&#100;&#x35;&#64;&#x74;&#101;&#x73;&#116;&#x2e;&#x63;&#x6f;&#109;</a></li>
<li>SMTP host:                               test.com</li>
<li>Web server HTTP port:                    8080</li>
<li>Web server HTTPS port:                   8443</li>
<li>Web server mode:                         https</li>
<li>IMAP server port:                        7143</li>
<li>IMAP server SSL port:                    7993</li>
<li>POP server port:                         7110</li>
<li>POP server SSL port:                     7995</li>
<li>Use spell check server:                  yes</li>
<li>Spell server URL:                        <a target="_blank" rel="noopener" href="http://test.com:7780/aspell.php">http://test.com:7780/aspell.php</a></li>
<li>Enable version update checks:            TRUE</li>
<li>Enable version update notifications:     TRUE</li>
<li>Version update notification email:       <a href="mailto:&#97;&#100;&#109;&#x69;&#110;&#x40;&#116;&#101;&#115;&#116;&#46;&#x63;&#x6f;&#x6d;">&#97;&#100;&#109;&#x69;&#110;&#x40;&#116;&#101;&#115;&#116;&#46;&#x63;&#x6f;&#x6d;</a></li>
<li>Version update source email:             <a href="mailto:&#x61;&#x64;&#x6d;&#x69;&#x6e;&#64;&#x74;&#101;&#x73;&#116;&#46;&#x63;&#111;&#109;">&#x61;&#x64;&#x6d;&#x69;&#x6e;&#64;&#x74;&#101;&#x73;&#116;&#46;&#x63;&#111;&#109;</a></li>
<li>Install mailstore (service webapp):      yes</li>
<li>Install UI (zimbra,zimbraAdmin webapps): yes<br>Select, or ‘r’ for previous menu [r] r</li>
</ol>
<pre><code>Main menu

   1) Common Configuration:
   2) zimbra-ldap:                             Enabled
   3) zimbra-logger:                           Enabled
   4) zimbra-mta:                              Enabled
   5) zimbra-dnscache:                         Enabled
   6) zimbra-snmp:                             Enabled
   7) zimbra-store:                            Enabled
   8) zimbra-spell:                            Enabled
   9) zimbra-proxy:                            Enabled
  10) zimbra-imapd:                            Enabled
  11) Default Class of Service Configuration:
   s) Save config to file
   x) Expand menu
   q) Quit
*** CONFIGURATION COMPLETE - press &#39;a&#39; to apply
Select from menu, or press &#39;a&#39; to apply config (? - help) s

Save config in file: [/opt/zimbra/config.17294]
Saving config in /opt/zimbra/config.17294...done.

Main menu

   1) Common Configuration:
   2) zimbra-ldap:                             Enabled
   3) zimbra-logger:                           Enabled
   4) zimbra-mta:                              Enabled
   5) zimbra-dnscache:                         Enabled
   6) zimbra-snmp:                             Enabled
   7) zimbra-store:                            Enabled
   8) zimbra-spell:                            Enabled
   9) zimbra-proxy:                            Enabled
  10) zimbra-imapd:                            Enabled
  11) Default Class of Service Configuration:
   s) Save config to file
   x) Expand menu
   q) Quit

*** CONFIGURATION COMPLETE - press &#39;a&#39; to apply
Select from menu, or press &#39;a&#39; to apply config (? - help) a
Save configuration data to a file? [Yes] yes
Save config in file: [/opt/zimbra/config.17294]
Saving config in /opt/zimbra/config.17294...done.
The system will be modified - continue? [No] yes
Operations logged to /tmp/zmsetup.20221116-225259.log
Setting local config values...done.
Initializing core config...Setting up CA...done.
Deploying CA to /opt/zimbra/conf/ca ...done.
Creating SSL zimbra-imapd certificate...
done.
Creating new zimbra-store SSL certificate...done.
Creating new zimbra-ldap SSL certificate...done.
Creating new zimbra-mta SSL certificate...done.
Creating new zimbra-proxy SSL certificate...done.
Installing mailboxd SSL certificates...done.
Installing imapd SSL certificates...done.
Installing MTA SSL certificates...done.
Installing LDAP SSL certificate...done.
Installing Proxy SSL certificate...done.
Initializing ldap...failed. (28160)

ERROR
Configuration failed

Please address the error and re-run /opt/zimbra/libexec/zmsetup.pl to
complete the configuration.
Errors have been logged to /tmp/zmsetup.20221116-225259.log

root@test:/tools/zcs8.8.15#
</code></pre>
<p>报错<br>    1、<br>        Configuration failed  hosts 配置错误<br>    2、<br>        starting servers… done  内存不够</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/09/ZimbraNote/" data-id="clcre41jl000lecvpfvkk5z8x" data-title="" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/01/09/zzcms%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2023/01/09/wordpress/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AV/">AV</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Domain/">Domain</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IPC/">IPC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Intranet/">Intranet</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Intranet/IPC/">IPC</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AV/" rel="tag">AV</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Domain/" rel="tag">Domain</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/AV/" style="font-size: 10px;">AV</a> <a href="/tags/Domain/" style="font-size: 10px;">Domain</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">一月 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/MS17-010">MS17-010</a>
          </li>
        
          <li>
            <a href="/2023/01/09/%E5%BC%BA%E8%A1%8C%E6%94%B9%E5%BC%80%E6%9C%BA%E5%AF%86%E7%A0%81/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/01/09/zzcms%E6%BC%8F%E6%B4%9E/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/01/09/zzcms%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/01/09/ZimbraNote/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 两袖空空<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>